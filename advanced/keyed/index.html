<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.31" />
    <meta name="description" content="libpasta - making passwords painless">


    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link rel="icon" href="/images/favicon.png" type="image/x-icon" />

    <title>Keyed Hashes :: libpasta</title>
    
    
    <link href="/css/nucleus.css?1511965179" rel="stylesheet">
    <link href="/css/hybrid.css?1511965179" rel="stylesheet">
    <link href="/css/featherlight.min.css?1511965179" rel="stylesheet">
    <link href="/css/auto-complete.css?1511965179" rel="stylesheet">
    <link href="/css/theme.css?1511965179" rel="stylesheet">
    <link href="/css/hugo-theme.css?1511965179" rel="stylesheet">
    
      <link href="/css/theme-libpasta.css?1511965179" rel="stylesheet">
    

    <script src="/js/jquery-2.x.min.js?1511965179"></script>
    
    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{ 
          display:none !important;
      }
      
    </style>
    
    <script src="/js/tabs.js"></script>
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400" rel="stylesheet"> 
<link rel="stylesheet" href="https://use.fontawesome.com/a927138ec7.css">

  </head>
  <body class="" data-url="/advanced/keyed/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://libpasta.github.io/">
<svg
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   id="svg8"
   version="1.1"
   viewBox="0 0 45.997559 10"
   height="12.242269mm"
   width="45.997559mm">
  <defs
     id="defs2" />
  <metadata
     id="metadata5">
    <rdf:RDF>
      <cc:Work
         rdf:about="">
        <dc:format>image/svg+xml</dc:format>
        <dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
        <dc:title></dc:title>
      </cc:Work>
    </rdf:RDF>
  </metadata>
  <g
     transform="translate(-66.952891,-67.060878)"
     id="layer1">
    <text
       id="text4487"
       y="100.10173"
       x="68.955536"
       style="font-style:normal;font-weight:normal;font-size:10.58333302px;line-height:125%;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.26458332px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
       xml:space="preserve"><tspan
         style="fill:#ffffff;stroke:#FFFFFF;stroke-width:0.26458332px"
         y="76.10173"
         x="68.955536"
         id="tspan4485">libpasta</tspan></text>
  </g>
</svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1511965179"></script>
<script type="text/javascript" src="/js/auto-complete.js?1511965179"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/libpasta.github.io\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1511965179"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/introduction/" title="Introduction" class="dd-item 
        
        
        
        ">
      <a href="/introduction/">
          <b>1. </b>Introduction
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/introduction/what-is-libpasta/" title="What is libpasta?" class="dd-item ">
        <a href="/introduction/what-is-libpasta/">
        What is libpasta?
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/introduction/basic-usage/" title="Basic Usage" class="dd-item ">
        <a href="/introduction/basic-usage/">
        Basic Usage
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/introduction/installation/" title="Installation" class="dd-item ">
        <a href="/introduction/installation/">
        Installation
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/introduction/password-hashing-theory/" title="Password hashing theory" class="dd-item ">
        <a href="/introduction/password-hashing-theory/">
        Password hashing theory
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/advanced/" title="Advanced Usage" class="dd-item 
        parent
        
        
        ">
      <a href="/advanced/">
          <b>2. </b>Advanced Usage
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/advanced/keyed/" title="Keyed Hashes" class="dd-item active">
        <a href="/advanced/keyed/">
        Keyed Hashes
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/advanced/migration/" title="Password Migration" class="dd-item ">
        <a href="/advanced/migration/">
        Password Migration
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/advanced/tuning/" title="Tuning &amp; Parameter Selection" class="dd-item ">
        <a href="/advanced/tuning/">
        Tuning &amp; Parameter Selection
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/other-languages/" title="Other Languages" class="dd-item 
        
        
        
        ">
      <a href="/other-languages/">
          <b>3. </b>Other Languages
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/other-languages/overview/" title="Overview" class="dd-item ">
        <a href="/other-languages/overview/">
        Overview
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/other-languages/c/" title="C" class="dd-item ">
        <a href="/other-languages/c/">
        C
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/other-languages/java/" title="Java" class="dd-item ">
        <a href="/other-languages/java/">
        Java
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/other-languages/php/" title="PHP" class="dd-item ">
        <a href="/other-languages/php/">
        PHP
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/other-languages/python/" title="Python" class="dd-item ">
        <a href="/other-languages/python/">
        Python
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/other-languages/ruby/" title="Ruby" class="dd-item ">
        <a href="/other-languages/ruby/">
        Ruby
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/technical-details/" title="Technical Details" class="dd-item 
        
        
        
        ">
      <a href="/technical-details/">
          <b>4. </b>Technical Details
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/technical-details/algorithm-choice/" title="Algorithm Selection" class="dd-item ">
        <a href="/technical-details/algorithm-choice/">
        Algorithm Selection
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/technical-details/randomness/" title="Randomness Problems" class="dd-item ">
        <a href="/technical-details/randomness/">
        Randomness Problems
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/technical-details/phc-string-format/" title="Serializing Hashes" class="dd-item ">
        <a href="/technical-details/phc-string-format/">
        Serializing Hashes
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/technical-details/supported/" title="Supported Algorithms" class="dd-item ">
        <a href="/technical-details/supported/">
        Supported Algorithms
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/libpasta-dev/" title="Developing libpasta" class="dd-item 
        
        
        
        ">
      <a href="/libpasta-dev/">
          <b>5. </b>Developing libpasta
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/libpasta-dev/contributing/" title="Contributing" class="dd-item ">
        <a href="/libpasta-dev/contributing/">
        Contributing
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/libpasta-dev/adding-languages/" title="Adding Languages" class="dd-item ">
        <a href="/libpasta-dev/adding-languages/">
        Adding Languages
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h4>More</h4>
        <ul>
          
              <li class="" role=""> 
                  <a class="padding" href="https://libpasta.github.io/blog/"><i class='fa fa-rss'></i> Blog</a>
              </li>
          
              <li class="" role=""> 
                  <a class="padding" href="https://github.com/libpasta/libpasta"><i class='fa fa-github'></i> Github (Rust)</a>
              </li>
          
              <li class="" role=""> 
                  <a class="padding" href="https://docs.rs/libpasta/"><i class='fa fa-book'></i> Documentation (Rust)</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fa fa-heart"></i></a> from <a href="http://getgrav.org">Grav</a> and <a href="http://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable sticky-parent">
              
              <div class="sticky-spacer">
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" href="https://github.com/libpasta/libpasta-hugo/edit/master/content/advanced/keyed.md" target="blank">
                      <i class="fa fa-code-fork"></i>
                      Edit this page
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fa fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                  
                  <span class="links">
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>libpasta</a> > <a href='/advanced/'>Advanced Usage</a> > Keyed Hashes
          
         
          
         
          
           
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">

    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1>Keyed Hashes</h1>
          

        


<p>We are currently developing support for keyed hashes: whether through HMAC or
encrypted values. For now, keys are generated and stored <em>locally in memory</em> in
the running instance, which means that any passwords which are stored while the
application is running will be useless if the application terminates and
destroys the keys.</p>

<p>The goal is for this structure to be flexible to any kinds of environments with
different sources.</p>

<p>For example, the following code configures a key for use in libpasta and
sets up HMAC to be used as a wrapping function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#66d9ef">use</span> libpasta::primitives::hmac::Hmac;
<span style="color:#66d9ef">use</span> libpasta::config::Config;

<span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> config <span style="color:#f92672">=</span> Config::default();

<span style="color:#75715e">// Some proper way of getting a key
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> key <span style="color:#f92672">=</span> <span style="color:#e6db74">b&#34;yellow submarine&#34;</span>;
<span style="color:#75715e">// The key source used by config is responsible for the key identifier
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> key_id <span style="color:#f92672">=</span> config.add_key(key);

<span style="color:#75715e">// Construct an HMAC instance and use this as the outer configuration
</span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> keyed_function <span style="color:#f92672">=</span> Hmac::with_key_id(<span style="color:#f92672">&amp;</span>digest::SHA256, <span style="color:#f92672">&amp;</span>key_id);
config.set_keyed_hash(keyed_function);</code></pre></div>
<p>Using <code>config.hash_function</code> will first hash using the default algorithm, and
then afterwards apply the HMAC to the output hash.</p>

<p>Alternate key sources can be specified by implementing the <code>key::Store</code> trait.
In the following example, we create a (bad!) key store, which uses a static key
for any identifier passed to it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#66d9ef">extern</span> <span style="color:#66d9ef">crate</span> libpasta;
<span style="color:#66d9ef">extern</span> <span style="color:#66d9ef">crate</span> ring;

<span style="color:#66d9ef">use</span> libpasta::key;
<span style="color:#66d9ef">use</span> ring::digest;

<span style="color:#75715e">#[derive(Debug)]</span>
<span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">StaticSource</span>(<span style="color:#f92672">&amp;</span>&#39;static [<span style="color:#66d9ef">u8</span>; <span style="color:#ae81ff">16</span>]);
<span style="color:#66d9ef">static</span> STATIC_SOURCE: <span style="color:#a6e22e">StaticSource</span> <span style="color:#f92672">=</span> StaticSource(<span style="color:#e6db74">b&#34;ThisIsAStaticKey&#34;</span>);

<span style="color:#66d9ef">impl</span> key::Store <span style="color:#66d9ef">for</span> StaticSource {
    <span style="color:#e6db74">/// Insert a new key into the `Store`.
</span><span style="color:#e6db74"></span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">insert</span>(<span style="color:#f92672">&amp;</span>self, _key: <span style="color:#66d9ef">&amp;</span>[<span style="color:#66d9ef">u8</span>]) -&gt; String {
        <span style="color:#e6db74">&#34;StaticKey&#34;</span>.to_string()
    }

    <span style="color:#e6db74">/// Get a key from the `Store`.
</span><span style="color:#e6db74"></span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">get_key</span>(<span style="color:#f92672">&amp;</span>self, _id: <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span>) -&gt; Option<span style="color:#f92672">&lt;</span>Vec<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">u8</span><span style="color:#f92672">&gt;&gt;</span> {
        Some(self.<span style="color:#ae81ff">0.</span>to_vec())
    }
}

<span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
    <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> config <span style="color:#f92672">=</span> libpasta::Config::default();
    config.set_key_source(<span style="color:#f92672">&amp;</span>STATIC_SOURCE);

    <span style="color:#75715e">// Construct an HMAC instance and use this as the outer configuration
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> keyed_function <span style="color:#f92672">=</span> libpasta::primitives::Hmac::with_key_id(<span style="color:#f92672">&amp;</span>digest::SHA256, <span style="color:#e6db74">&#34;key&#34;</span>);
    config.set_keyed_hash(keyed_function);

    <span style="color:#66d9ef">let</span> hash <span style="color:#f92672">=</span> config.hash_password(<span style="color:#e6db74">&#34;hunter2&#34;</span>.to_string());
    println<span style="color:#f92672">!</span>(<span style="color:#e6db74">&#34;Computed hash: {:?}&#34;</span>, hash);
}</code></pre></div>

<footer class=" footline" >
	
</footer>


        
        </div> 
      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
        
                    
            
        
        
        


        
            <a class="nav nav-prev" href="/advanced/" title="Advanced Usage"> <i class="fa fa-chevron-left"></i></a>
        
        
            <a class="nav nav-next" href="/advanced/migration/" title="Password Migration" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
        
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1511965179"></script>
    <script src="/js/jquery.sticky-kit.min.js?1511965179"></script>
    <script src="/js/featherlight.min.js?1511965179"></script>
    <script src="/js/html5shiv-printshiv.min.js?1511965179"></script>
    <script src="/js/modernizr.custom.71422.js?1511965179"></script>
    <script src="/js/learn.js?1511965179"></script>
    <script src="/js/hugo-learn.js?1511965179"></script>

    

  </body>
</html>

